{"componentChunkName":"component---src-templates-doc-tsx","path":"/blog/2020-12-08-improving-latency-with-defer-and-stream-directives","result":{"data":{"doc":{"frontmatter":{"title":"Improving Latency with @defer and @stream Directives","heroText":null,"date":"2020-12-08T00:00:00.000Z","permalink":"/blog/2020-12-08-improving-latency-with-defer-and-stream-directives","byline":"Rob Richard, Liliana Matos","guestBio":null,"sublinks":null,"layout":"blog","tags":["announcements"]},"id":"344e7874-fe7f-5825-ad86-afd237edb638","rawMarkdownBody":"\n> Rob Richard and Liliana Matos are front-end engineers at [1stDibs.com](https://www.1stdibs.com). They have been working with the GraphQL Working Group as champions of the the `@defer` and `@stream` directives.\n\nThe `@defer` and `@stream` directives have been a much anticipated set of features ever since Lee Byron first talked about it at [GraphQL Europe 2016](https://youtu.be/ViXL0YQnioU?t=769). For most of 2020, we have been working with the GraphQL Working Group to standardize this feature. It is now a Stage 2 proposal, but to advance further, we are looking to the GraphQL community to try using these directives and provide feedback. We have released experimental versions of `GraphQL.js` and `express-graphql`. They are published to npm under `graphql@experimental-stream-defer` and `express-graphql@experimental-stream-defer`. We encourage everyone interested in this feature to try out these releases and let us know how it goes in the [issue created for feedback](https://github.com/graphql/graphql-js/issues/2848). Read on to find out more about what this proposal offers.\n\nOne of the disadvantages of GraphQL’s request/response model is that the GraphQL response is not returned to clients until the entire request has finished processing. However, not all requested data may be of equal importance, and in some use cases it may be possible for applications to act on a subset of the requested data. An application can speed up its time-to-interactive if the GraphQL server can send the most important data as soon as it’s ready. The new `@defer` and `@stream` directives allow GraphQL servers to do exactly that by returning multiple payloads from a single GraphQL response. \n\nThe `@defer` directive can be applied to fragment spreads and inline fragments. It is a declarative way for developers to mark parts of a query as non-essential for immediate return. \n\nHere’s an example of the `@defer` directive:\n\n#### Request\n\n```graphql\nquery {\n  person(id: \"cGVvcGxlOjE=\") {\n    name\n    ...HomeworldFragment @defer(label: \"homeworldDefer\")\n}\n\nfragment HomeworldFragment on Person {\n    homeworld {\n      name\n    }\n}\n```\n\n#### Response\n\n**Payload 1**\n\n```json\n{\n  \"data\": { \n    \"person\": {\n      \"name\": \"Luke Skywalker\"\n    }\n  },\n  \"hasNext\": true\n}\n```\n\n**Payload 2**\n\n```json\n{\n  \"label\": \"homeworldDefer\",\n  \"path\": [\"person\"],\n  \"data\": { \n    \"homeworld\": {\n      \"name\": \"Tatooine\"\n    }\n  },\n  \"hasNext\": false\n}\n```\n\nWhen the GraphQL execution engine encounters the `@defer` directive, it will fork execution and begin to resolve those fields asynchronously. While the deferred payload is still being prepared, the client can receive and act on the initial payload. This is most useful when the deferred data is large, expensive to load, or not on the critical path for interactivity.\n\nSimilar to `@defer`, the `@stream` directive also allows the client to receive data before the entire result is ready. `@stream` can be used on list fields. Here’s an example of the `@stream` directive:\n\n#### Request\n\n```graphql\nquery {\n  person(id: \"cGVvcGxlOjE=\") {\n    name\n    films @stream(initialCount: 2, label: \"filmsStream\") {\n      title\n    }\n}\n```\n\n#### Response\n\n**Payload 1**\n\n```json\n{\n  \"data\": { \n    \"person\": {\n      \"name\": \"Luke Skywalker\",\n      \"films\": [\n        { \"title\": \"A New Hope\" },\n        { \"title\": \"The Empire Strikes Back\" }\n      ]\n    }\n  },\n  \"hasNext\": true\n}\n```\n\n**Payload 2**\n\n```json\n{\n  \"label\": \"filmsStream\",\n  \"path\": [\"person\", \"films\", 2],\n  \"data\": { \n    \"title\": \"Return of the Jedi\"\n  },\n  \"hasNext\": true\n}\n```\n\n**Payload 3**\n\n```json\n{\n  \"label\": \"filmsStream\",\n  \"path\": [\"person\", \"films\", 3],\n  \"data\": { \n    \"title\": \"Revenge of the Sith\"\n  },\n  \"hasNext\": false\n}\n```\n\nWhen the GraphQL execution engine encounters the `@stream` directive, it will resolve as many list items specified by the `initialCount` argument. The rest will be resolved  asynchronously. This is especially useful for an interface where only a few elements can be rendered above the fold. The client can render these elements as soon as possible while the server is still resolving the rest of the data.\n\nWhile the GraphQL specification doesn’t specify transport protocols, we expect the most common transport for queries with `@defer`/`@stream` to be HTTP with chunked transfer encoding. This allows a GraphQL server to keep a standard HTTP connection open, while streaming each payload to the client as soon as it’s ready. It has low overhead, has been supported by browsers for decades, and can work easily with most infrastructure.\n\nYou can learn more about these directives at:\n\n* [The @defer/@stream RFC](https://github.com/graphql/graphql-spec/blob/master/rfcs/DeferStream.md)\n* [The proposed spec edits](https://github.com/graphql/graphql-spec/pull/742)\n* [The GraphQL Incremental Delivery over HTTP RFC](https://github.com/graphql/graphql-over-http/blob/master/rfcs/IncrementalDelivery.md)\n* [Our talk at GraphQL Summit 2020](https://www.youtube.com/watch?v=icv_Pq06aOY)\n\n> – **Rob Richard**, **Liliana Matos**, Front-End Engineering, 1stDibs.com\n"},"nextDoc":{"frontmatter":{"title":"","permalink":null}}},"pageContext":{"permalink":"/blog/2020-12-08-improving-latency-with-defer-and-stream-directives","nextPermalink":null,"sideBarData":[{"name":"blog","links":[{"fileAbsolutePath":"/home/runner/work/graphql.github.io/graphql.github.io/src/content/blog/2021-04-30-newsletter-april-2021.md","parent":{"relativeDirectory":"blog","sourceInstanceName":"content"},"frontmatter":{"title":"GraphQL Foundation Monthly Newsletter April 2021","permalink":"/blog/2021-04-30-graphql-foundation-monthly-newsletter-april-2021","next":null,"category":null,"sublinks":null,"sidebarTitle":null,"date":"2021-04-30T00:00:00.000Z","tags":["newsletter"]},"id":"ba11bc5b-58b7-54fd-983d-afae956acb32"},{"fileAbsolutePath":"/home/runner/work/graphql.github.io/graphql.github.io/src/content/blog/2021-03-31-newsletter-march-2021.md","parent":{"relativeDirectory":"blog","sourceInstanceName":"content"},"frontmatter":{"title":"GraphQL Foundation Monthly Newsletter March 2021","permalink":"/blog/2021-03-31-graphql-foundation-monthly-newsletter-march-2021","next":null,"category":null,"sublinks":null,"sidebarTitle":null,"date":"2021-03-31T00:00:00.000Z","tags":["newsletter"]},"id":"dd09971c-8d98-57e1-8993-776436dadeb9"},{"fileAbsolutePath":"/home/runner/work/graphql.github.io/graphql.github.io/src/content/blog/2021-02-15-newsletter-february-2021.md","parent":{"relativeDirectory":"blog","sourceInstanceName":"content"},"frontmatter":{"title":"GraphQL Foundation Monthly Newsletter February 2021","permalink":"/blog/2021-02-15-graphql-foundation-monthly-newsletter-february-2021","next":null,"category":null,"sublinks":null,"sidebarTitle":null,"date":"2021-02-15T00:00:00.000Z","tags":["newsletter"]},"id":"c6698c37-237f-51a2-b3b5-c54d087177d6"},{"fileAbsolutePath":"/home/runner/work/graphql.github.io/graphql.github.io/src/content/blog/2020-12-08-defer-stream.md","parent":{"relativeDirectory":"blog","sourceInstanceName":"content"},"frontmatter":{"title":"Improving Latency with @defer and @stream Directives","permalink":"/blog/2020-12-08-improving-latency-with-defer-and-stream-directives","next":null,"category":null,"sublinks":null,"sidebarTitle":null,"date":"2020-12-08T00:00:00.000Z","tags":["announcements"]},"id":"344e7874-fe7f-5825-ad86-afd237edb638"},{"fileAbsolutePath":"/home/runner/work/graphql.github.io/graphql.github.io/src/content/blog/2020-11-12-newsletter-october-2020.md","parent":{"relativeDirectory":"blog","sourceInstanceName":"content"},"frontmatter":{"title":"GraphQL Foundation Monthly Newsletter October 2020","permalink":"/blog/2020-11-12-graphql-foundation-monthly-newsletter-october-2020","next":null,"category":null,"sublinks":null,"sidebarTitle":null,"date":"2020-11-12T00:00:00.000Z","tags":["newsletter"]},"id":"1f3f8f4f-4988-5e7a-aeda-f0d35fe78281"},{"fileAbsolutePath":"/home/runner/work/graphql.github.io/graphql.github.io/src/content/blog/2020-10-15-newsletter-september-2020.md","parent":{"relativeDirectory":"blog","sourceInstanceName":"content"},"frontmatter":{"title":"GraphQL Foundation Monthly Newsletter September 2020","permalink":"/blog/2020-10-15-graphql-foundation-monthly-newsletter-september-2020","next":null,"category":null,"sublinks":null,"sidebarTitle":null,"date":"2020-10-15T00:00:00.000Z","tags":["newsletter"]},"id":"2331558b-dab1-5e92-b30e-b7cdb529d7d4"},{"fileAbsolutePath":"/home/runner/work/graphql.github.io/graphql.github.io/src/content/blog/2020-09-21-gsod-2020-carolyn.md","parent":{"relativeDirectory":"blog","sourceInstanceName":"content"},"frontmatter":{"title":"Google Season of Docs 2020 Participant: Carolyn Stransky","permalink":"/blog/2020-09-21-gsod-carolyn-stransky","next":null,"category":null,"sublinks":null,"sidebarTitle":null,"date":"2020-09-21T00:00:00.000Z","tags":["announcements"]},"id":"106f781d-cc34-5d8a-8a43-f4ae254dd642"},{"fileAbsolutePath":"/home/runner/work/graphql.github.io/graphql.github.io/src/content/blog/2020-09-11-newsletter-august-2020.md","parent":{"relativeDirectory":"blog","sourceInstanceName":"content"},"frontmatter":{"title":"GraphQL Foundation Monthly Newsletter August 2020","permalink":"/blog/2020-09-11-graphql-foundation-monthly-newsletter-august-2020","next":null,"category":null,"sublinks":null,"sidebarTitle":null,"date":"2020-09-11T00:00:00.000Z","tags":["newsletter"]},"id":"0e6c7481-10b1-59da-8ad1-9101e6456756"},{"fileAbsolutePath":"/home/runner/work/graphql.github.io/graphql.github.io/src/content/blog/2020-06-30-gsoc-2020-naman.md","parent":{"relativeDirectory":"blog","sourceInstanceName":"content"},"frontmatter":{"title":"Google Summer of Code 2020 Participant: Naman","permalink":"/blog/2020-06-30-gsoc-2020-participant-naman","next":null,"category":null,"sublinks":null,"sidebarTitle":null,"date":"2020-06-30T00:00:00.000Z","tags":["announcements"]},"id":"1e087a47-70ea-5872-9994-899bc367a71d"},{"fileAbsolutePath":"/home/runner/work/graphql.github.io/graphql.github.io/src/content/blog/2020-06-13-season-of-docs.md","parent":{"relativeDirectory":"blog","sourceInstanceName":"content"},"frontmatter":{"title":"GraphQL joins Google Season of Docs","permalink":"/blog/2020-06-13-graphql-joins-google-season-of-docs","next":null,"category":null,"sublinks":null,"sidebarTitle":null,"date":"2020-06-13T00:00:00.000Z","tags":["announcements"]},"id":"612cbbf6-f4cc-5e95-8e75-0b317b5e43ab"},{"fileAbsolutePath":"/home/runner/work/graphql.github.io/graphql.github.io/src/content/blog/2020-04-03-graphiql-graphql-playground.md","parent":{"relativeDirectory":"blog","sourceInstanceName":"content"},"frontmatter":{"title":"Web-based GraphQL IDEs for the win: How & Why Playground & GraphiQL are joining forces","permalink":"/blog/2020-04-03-web-based-graphql-ides-for-the-win","next":null,"category":null,"sublinks":null,"sidebarTitle":null,"date":"2020-04-03T00:00:00.000Z","tags":["announcements"]},"id":"245fd8ba-d9d8-5c55-adb3-c74598bdd851"},{"fileAbsolutePath":"/home/runner/work/graphql.github.io/graphql.github.io/src/content/blog/2020-04-02-graphql-annual-report-2019.md","parent":{"relativeDirectory":"blog","sourceInstanceName":"content"},"frontmatter":{"title":"Announcing the 1st GraphQL Foundation Annual Report","permalink":"/blog/2020-04-02-announcing-the-first-graphql-foundation-annual-report","next":null,"category":null,"sublinks":null,"sidebarTitle":null,"date":"2020-04-02T00:00:00.000Z","tags":["announcements"]},"id":"282bd6a8-2659-5e4c-8a2e-e4d3a2f9a191"},{"fileAbsolutePath":"/home/runner/work/graphql.github.io/graphql.github.io/src/content/blog/2019-10-31-linux-foundation-training.md","parent":{"relativeDirectory":"blog","sourceInstanceName":"content"},"frontmatter":{"title":"Linux Foundation Training Announces a Free Online Course-Exploring GraphQL: A Query Language for APIs","permalink":"/blog/2019-10-31-linux-foundation-training-announces-free-online-course-exploring-graphql","next":null,"category":null,"sublinks":null,"sidebarTitle":null,"date":"2019-10-31T00:00:00.000Z","tags":["announcements"]},"id":"817e408e-4abd-5ac3-aed5-7def6058da7e"},{"fileAbsolutePath":"/home/runner/work/graphql.github.io/graphql.github.io/src/content/blog/2019-10-28-interactive-landscape.md","parent":{"relativeDirectory":"blog","sourceInstanceName":"content"},"frontmatter":{"title":"GraphQL Foundation Launches Interactive Landscape and Welcomes New Members from Open Source Summit Europe","permalink":"/blog/2019-10-28-graphql-foundation-launches-interactive-landscape-welcomes-new-members","next":null,"category":null,"sublinks":null,"sidebarTitle":null,"date":"2019-10-28T00:00:00.000Z","tags":["announcements"]},"id":"8dcf1dc8-1095-57c2-b499-4659184941b1"},{"fileAbsolutePath":"/home/runner/work/graphql.github.io/graphql.github.io/src/content/blog/2019-03-12-joint-development-foundation.md","parent":{"relativeDirectory":"blog","sourceInstanceName":"content"},"frontmatter":{"title":"The GraphQL Foundation Announces Collaboration with the Joint Development Foundation to Drive Open Source and Open Standards","permalink":"/blog/2019-03-12-graphql-foundation-announces-collaboration-with-jdf","next":null,"category":null,"sublinks":null,"sidebarTitle":null,"date":"2019-03-12T00:00:00.000Z","tags":["announcements"]},"id":"5e901127-d944-5e55-9dc2-9a75251ea4a0"},{"fileAbsolutePath":"/home/runner/work/graphql.github.io/graphql.github.io/src/content/blog/2018-11-12-channel-futures.md","parent":{"relativeDirectory":"blog","sourceInstanceName":"content"},"frontmatter":{"title":"Channel Futures: GraphQL API Query Language Growing, Gets Own Support Foundation","permalink":"/blog/2018-11-12-channel-futures-graphql-api-query-language-growing","next":null,"category":null,"sublinks":null,"sidebarTitle":null,"date":"2018-11-12T00:00:00.000Z","tags":["in-the-news"]},"id":"766c89d5-07fc-58f7-a23e-c5a7d4e4cf8a"},{"fileAbsolutePath":"/home/runner/work/graphql.github.io/graphql.github.io/src/content/blog/2018-11-07-datanami.md","parent":{"relativeDirectory":"blog","sourceInstanceName":"content"},"frontmatter":{"title":"Datanami: Will GraphQL Become a Standard for the New Data Economy?","permalink":"/blog/2018-11-07-datanami-will-graphql-become-a-standard-for-the-new-data-economy","next":null,"category":null,"sublinks":null,"sidebarTitle":null,"date":"2018-11-07T00:00:00.000Z","tags":["in-the-news"]},"id":"1e6b5b67-2ceb-5b5c-86c6-56fc1ce12f8a"},{"fileAbsolutePath":"/home/runner/work/graphql.github.io/graphql.github.io/src/content/blog/2018-11-07-sd-times.md","parent":{"relativeDirectory":"blog","sourceInstanceName":"content"},"frontmatter":{"title":"SD Times: The Linux Foundation announces plans to form GraphQL foundation","permalink":"/blog/2018-11-07-sd-times-lf-announces-plans-to-form-graphql-foundation","next":null,"category":null,"sublinks":null,"sidebarTitle":null,"date":"2018-11-07T00:00:00.000Z","tags":["in-the-news"]},"id":"ce3427b2-7fdb-51be-a5eb-b9ec28ac8770"},{"fileAbsolutePath":"/home/runner/work/graphql.github.io/graphql.github.io/src/content/blog/2018-11-07-the-register.md","parent":{"relativeDirectory":"blog","sourceInstanceName":"content"},"frontmatter":{"title":"The Register: Facebook’s open-source license drama-zone GraphQL gets swanky digs in Linux mansion","permalink":"/blog/2018-11-07-the-register","next":null,"category":null,"sublinks":null,"sidebarTitle":null,"date":"2018-11-07T00:00:00.000Z","tags":["in-the-news"]},"id":"a06863ea-bba8-5b3f-9dca-13d33c400cef"},{"fileAbsolutePath":"/home/runner/work/graphql.github.io/graphql.github.io/src/content/blog/2018-11-06-eweek.md","parent":{"relativeDirectory":"blog","sourceInstanceName":"content"},"frontmatter":{"title":"eWeek: GraphQL API Specification Moving Forward with Independent Foundation","permalink":"/blog/2018-11-06-eweek-graphql-api-specification-moving-forward-with-independent-foundation","next":null,"category":null,"sublinks":null,"sidebarTitle":null,"date":"2018-11-06T00:00:00.000Z","tags":["in-the-news"]},"id":"1e4a6e1b-cdd6-5a9b-993c-a5ed90a0f18e"},{"fileAbsolutePath":"/home/runner/work/graphql.github.io/graphql.github.io/src/content/blog/2018-11-06-infoworld.md","parent":{"relativeDirectory":"blog","sourceInstanceName":"content"},"frontmatter":{"title":"InfoWorld: GraphQL gets its own foundation","permalink":"/blog/2018-11-06-infoworld-graphql-gets-its-own-foundation","next":null,"category":null,"sublinks":null,"sidebarTitle":null,"date":"2018-11-06T00:00:00.000Z","tags":["in-the-news"]},"id":"b17f197e-2c9e-5f92-be5f-508a22269643"},{"fileAbsolutePath":"/home/runner/work/graphql.github.io/graphql.github.io/src/content/blog/2018-11-06-linux-foundation-graphql.md","parent":{"relativeDirectory":"blog","sourceInstanceName":"content"},"frontmatter":{"title":"The Linux Foundation Announces Intent to Form New Foundation to Support GraphQL","permalink":"/blog/2018-11-06-linux-foundation-announces-intent-to-form-new-foundation-to-support-graphql","next":null,"category":null,"sublinks":null,"sidebarTitle":null,"date":"2018-11-06T00:00:00.000Z","tags":["announcements"]},"id":"c503e763-b025-5066-a0c5-403bb518472b"},{"fileAbsolutePath":"/home/runner/work/graphql.github.io/graphql.github.io/src/content/blog/2017-11-08-programmable-web.md","parent":{"relativeDirectory":"blog","sourceInstanceName":"content"},"frontmatter":{"title":"ProgrammableWeb: GraphQL Moving to Neutral, Open-Source Foundation","permalink":"/blog/2017-11-08-programmableweb-graphql-moving-to-neutral-open-source-foundation","next":null,"category":null,"sublinks":null,"sidebarTitle":null,"date":"2017-11-08T00:00:00.000Z","tags":["in-the-news"]},"id":"946b6e8c-821f-52f1-9255-8869fa933e70"},{"fileAbsolutePath":"/home/runner/work/graphql.github.io/graphql.github.io/src/content/blog/2016-09-14-production-ready.md","parent":{"relativeDirectory":"blog","sourceInstanceName":"content"},"frontmatter":{"title":"Leaving technical preview","permalink":"/blog/production-ready/","next":null,"category":null,"sublinks":null,"sidebarTitle":null,"date":"14 Sep 2016","tags":["blog"]},"id":"b6b98148-ef53-5ee8-8430-1d3e5238fdbf"},{"fileAbsolutePath":"/home/runner/work/graphql.github.io/graphql.github.io/src/content/blog/2016-05-02-rest-api-graphql-wrapper.md","parent":{"relativeDirectory":"blog","sourceInstanceName":"content"},"frontmatter":{"title":"Wrapping a REST API in GraphQL","permalink":"/blog/rest-api-graphql-wrapper/","next":null,"category":null,"sublinks":null,"sidebarTitle":null,"date":"2016-05-05T00:00:00.000Z","tags":["blog"]},"id":"d3cc340c-7c24-5e27-a664-64839d704b7c"},{"fileAbsolutePath":"/home/runner/work/graphql.github.io/graphql.github.io/src/content/blog/2016-04-19-mocking.md","parent":{"relativeDirectory":"blog","sourceInstanceName":"content"},"frontmatter":{"title":"Mocking your server is easy with GraphQL","permalink":"/blog/mocking-with-graphql/","next":null,"category":null,"sublinks":null,"sidebarTitle":null,"date":"19 Apr 2016","tags":["blog"]},"id":"b23324d3-c2c9-5923-9b1a-9619ed9c0ab0"},{"fileAbsolutePath":"/home/runner/work/graphql.github.io/graphql.github.io/src/content/blog/2015-10-16-subscriptions.md","parent":{"relativeDirectory":"blog","sourceInstanceName":"content"},"frontmatter":{"title":"Subscriptions in GraphQL and Relay","permalink":"/blog/subscriptions-in-graphql-and-relay/","next":null,"category":null,"sublinks":null,"sidebarTitle":null,"date":"16 Oct 2015","tags":["blog","spec"]},"id":"68004958-9193-5dc8-9f9a-e0257002a44e"},{"fileAbsolutePath":"/home/runner/work/graphql.github.io/graphql.github.io/src/content/blog/2015-09-14-graphql.md","parent":{"relativeDirectory":"blog","sourceInstanceName":"content"},"frontmatter":{"title":"GraphQL: A data query language","permalink":"/blog/graphql-a-query-language/","next":null,"category":null,"sublinks":null,"sidebarTitle":null,"date":"14 Sep 2015","tags":["blog","spec"]},"id":"54662990-8461-5d87-a761-430d95b88d9d"}]}],"sourcePath":"src/content/blog/2020-12-08-defer-stream.md"}},"staticQueryHashes":["1581580458","4162432391"]}